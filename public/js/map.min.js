function generateMarkers(e){pullPaginatorElementToFirstElement();var a={};try{a.lat_min=e.getSouthWest().lat(),a.lat_max=e.getNorthEast().lat(),a.lon_min=e.getSouthWest().lng(),a.lon_max=e.getNorthEast().lng()}catch(e){return console.error("Element not called"),void console.error(e)}var t=[];$("input[name='sub_category[]']:checked").each(function(){t.push($(this).val())}),$.ajax({headers:{"X-CSRF-TOKEN":$("meta[name=_token]").attr("content")},url:$("meta[name=listing_map_ajax_url]").attr("content"),method:"POST",data:{lat_min:a.lat_min,lat_max:a.lat_max,lon_min:a.lon_min,lon_max:a.lon_max,current_page_no:$("meta[name=current_page_no]").attr("content"),content_per_page:$("meta[name=content_per_page]").attr("content"),sort_ordering:$("#sort_ordering").val(),price_range_min:$("#price_range").val().split(",")[0],price_range_max:$("#price_range").val().split(",")[1],sub_categories:t,search_value:$("#input_nav_search").val()},success:function(e){fixInfowindowScroll(),clearMarkers();var a=[];$.each(e,function(e,t){"showing_start"===e?$("#record_showing_start").html(t):"showing_end"===e?$("#record_showing_end").html(t):"total_element"===e?$("#total_match_found").html(t):"total_page"===e?0===t?$("#show_paginator").bootpag({total:1}):$("#show_paginator").bootpag({total:t}):"current_page"===e||("data"===e?$.each(t,function(e,t){null==t.advertisement_image&&(t.advertisement_image="../images/not_available_1.png");var i;null!=t.user_image&&t.user_image.length<4&&(t.user_image="../images/empty-profile.jpg"),i='<div class="col-lg-4 col-sm-6"><div class="pos-rel"><a href="#" add_id="'+t.id+'" class="add_to_wishlist wsh-lst"><img src="'+t.hearts_image+'"></img></a><div class="box showonmap9" marker_id='+t.id+'><div class="img-box-list"><img src="'+$("meta[name=upload_folder_url]").attr("content")+t.advertisement_image+'"></div><div class="box-content"><h5 class="text-center">'+t.title+"</h5><h6> $"+t.price+'</h6><div class="clearfix margin-bottom-ten"></div><img height="46" width="46" class="pull-left width-adj2" src="'+$("meta[name=upload_folder_url]").attr("content")+t.user_image+'"><div class="pull-left margin-left-ten width-adj3"><p class="pull-left dot1">'+t.description+"<br></p></div></div></div></div></div>",$("#box").append(i),a.push({latLng:[t.lat,t.lon],class:"markers",options:{icon:"http://maps.google.com/mapfiles/marker_green.png"},id:t.id,data:{title:t.title,price:t.price,title_image_url:$("meta[name=upload_folder_url]").attr("content")+t.advertisement_image,description:t.description,view_detail_url:"#"+t.id,id:t.id,hearts_image:t.hearts_image},events:{click:function(e,a,i){var o=i.data.description;o='<div class="map-master-div" onclick="showAddDetail('+i.data.id+')"><div class="pos-rel"><a href="#" onclick="addToWisList('+i.data.id+',this)" class="add_to_wishlist wsh-lst-infowindow"><img src="'+i.data.hearts_image+'"></img></a><div class="box"><div class="img-box-list info-image-box"><img class="infowindow-image" src="'+$("meta[name=upload_folder_url]").attr("content")+t.advertisement_image+'"></div><div class="box-content box-content-map"><h5><div class="pull-center">'+i.data.title+"</div></h5><h6> $"+i.data.price+"</h6></div></div></div></div>";var n=$(this).gmap3("get");infoBubble.close(),infoBubble.setContent(o),infoBubble.open(n,e),fixInfowindowScroll(),last_opened_info_window_id=i.data.id},mouseout:function(){}}})}):"categories"===e?($("span[categoryCount]").html("0"),$("#category_filter span[categoryCount]").parent().parent().addClass("hidden-menu-item"),$.each(t,function(e,a){$('span[categoryCount="'+a.category_id+'"]').html(a.count),$('#category_filter span[categoryCount="'+a.category_id+'"]').parent().parent().removeClass("hidden-menu-item")})):"sub-categories"===e&&($("span[subCategoryCount]").html("0"),$("#category_filter span[subCategoryCount]").parent().parent().addClass("hidden-menu-item"),$.each(t,function(e,a){$('span[subCategoryCount="'+a.sub_category_id+'"]').html(a.count),$('#category_filter span[subCategoryCount="'+a.sub_category_id+'"]').parent().parent().removeClass("hidden-menu-item")})))}),map_div.gmap3({marker:{values:a}}),openLastInfoWindow()},error:function(e,a,t){console.log("AJAX Not Done Successfully")}}),openLastInfoWindow()}function showAddDetail(e){is_wishlist_propagated||($.ajax({headers:{"X-CSRF-TOKEN":$("meta[name=_token]").attr("content")},method:"POST",url:$("meta[name=product_detail_ajax_url]").attr("content"),dataType:"json",data:{product_id:e},success:function(a){$.each(a,function(e,a){if(0==e.localeCompare("advertisement"))$.each(a,function(e,a){if(0==e.localeCompare("id"))$('#write_review input[name="add_id"]').val(a),$("#selected_add_id").val(a),$("#offer_selected_add_id").val(a);else if(0==e.localeCompare("is_reviewed"))1==a?$(".review").hide():$(".review").show();else if(0==e.localeCompare("is_wishlisted"))1==a?$("img.add_detail").attr("src",$("meta[name=filleds_heart_svg]").attr("content")):$("img.add_detail").attr("src",$("meta[name=svg_hearts]").attr("content"));else if(0==e.localeCompare("is_offer_sent"))0==a?$("#offer_send_warning").hide():$("#offer_send_warning").show();else if(0==e.localeCompare("title"))$("#selected_add_title").html(a);else if(0==e.localeCompare("price"))$("#selected_add_price").html(a);else if(0==e.localeCompare("description"))$("#selected_add_description").html(a);else if(0==e.localeCompare("address"))$("#selected_add_direction").attr("address",a);else if(0==e.localeCompare("location_lat"))$("#selected_add_direction").attr("location_lat",a);else if(0==e.localeCompare("location_lon"))$("#selected_add_direction").attr("location_lon",a);else if(0==e.localeCompare("user"))$.each(a,function(e,a){console.log(a)});else if(0==e.localeCompare("advertisement_images"))$(".variable-width").slick("unslick"),$(".variable-width").empty(),null!=a&&a.length>0?$.each(a,function(e,a){$(".variable-width").prepend('<div><img src="'+$("meta[name=upload_folder_url]").attr("content")+a.image_name+'"></div>')}):$(".variable-width").prepend('<div><img src="'+$("meta[name=base_url]").attr("content")+'/images/not_available_2.png"></div>'),fixImageSlider(),$(".variable-width").slick(getSliderSettings());else if(0==e.localeCompare("total_views"))$("#selected_add_view_count").attr("data-original-title",a);else if(0==e.localeCompare("avg_rating")){for($("#add_rating").empty(),i=0;i<Math.round(a);i++)$("#add_rating").append('<i class="fa fa-star green-text"></i>');for(i=Math.round(a);i<5;i++)$("#add_rating").append('<i class="fa fa-star-o"></i>')}});else if(0==e.localeCompare("reviews"))$(".reviews").empty(),$.each(a,function(e,a){var t=new Object;$.each(a,function(e,a){0==e.localeCompare("added_on")?t.added_on=formatTime(convertToLocalTime(a)):0==e.localeCompare("rating")?t.rating=a:0==e.localeCompare("review")?t.review=a:0==e.localeCompare("user_name")&&(t.user_name=a)});for(var i="",o=0;o<t.rating;o++)i+='<i class="fa fa-star fa-xs green-text"></i>';for(o=t.rating;o<5;o++)i+='<i class="fa fa-star-o fa-xs"></i>';var n='<div class="col-lg-4 rone">'+t.user_name+"<br>"+i+"<br/><span>"+t.added_on+'</span></div><div class="col-lg-8 rtwo"><span>'+t.review+'</span></div><div class="clearfix margin-twenty"></div>';$(".reviews").append(n)});else if(0==e.localeCompare("add_owner")){for($("#offer_add_owner_name").html(a.user_name),$("#offer_add_owner_email").html(a.email),$("#offer_add_owner_cell").html(a.cell_no),$("#add_owner_image").attr("src",a.profile_picture),$("#add_owner_name").html(a.user_name),$("#add_owner_phone").html("<i class='fa fa-phone'></i> <a href='tel:"+a.cell_no+"''>"+a.cell_no+"</a>"),$("#add_owner_website").html("<i class='fa fa-globe'></i> <a href='"+a.website+"''>"+a.website+"</a>"),$("#add_owner_email").html("<i class='fa fa-envelope'></i> <a href='mailto:"+a.email+"''>"+a.email+"</a>"),"not_verified"==a.fb_verification_status?$("#add_owner_fb_status").html('<i class="fa fa-facebook"></i>Facebook Not Verified'):$("#add_owner_fb_status").html('<i class="fa fa-facebook"></i><i class="fa fa-check-circle p-adj"></i><a href="#">Facebook Verified</a>'),$("#add_owner_id").val(a.user_id),$("#offer_add_owner_id").val(a.user_id),$('#write_review input[name="add_owner_id"]').val(a.user_id),$("#add_owner_rating").empty(),i=0;i<a.user_rating;i++)$("#add_owner_rating").append('<i class="fa fa-star green-text"></i>');for(i=a.user_rating;i<5;i++)$("#add_owner_rating").append('<i class="fa fa-star-o"></i>')}}),$("#fb_share").attr("href",$("meta[name=fb_share_url]").attr("content")+"%23"+e),$("#tw_share").attr("href",$("meta[name=tw_share_url]").attr("content")+"%23"+e),$("#gp_share").attr("href",$("meta[name=gp_share_url]").attr("content")+"%23"+e);var t="https://www.google.com/maps/dir//"+$("#selected_add_direction").attr("address")+"/@"+$("#selected_add_direction").attr("location_lat")+","+$("#selected_add_direction").attr("location_lon");$("#selected_add_direction").attr("href",t)}}),$(".ad-detail").show("slow"),$(".ad-listing").hide("slow"),$(".close-detail").addClass("show"),$(".variable-width").slick(getSliderSettings()))}function ifDeviceIsMobile(){return!$("#map").is(":visible")}function closeAddDetail(){$(".ad-detail").hide("slow"),$(".ad-listing").show("slow"),$(".close-detail").removeClass("show"),clearPrevRoutes()}function openInfoWindowByID(e){last_opened_info_window_id=e,google.maps.event.trigger(map_div.gmap3({get:{id:last_opened_info_window_id}}),"click"),fixInfowindowScroll()}function openLastInfoWindow(){-1!==last_opened_info_window_id&&google.maps.event.trigger(map_div.gmap3({get:{id:last_opened_info_window_id}}),"click")}function pullPaginatorElementToFirstElement(){"false"===$("meta[name=is_paginator_clicked]").attr("content")&&($("meta[name=current_page_no]").attr("content",1),$("#show_paginator").bootpag({page:1}))}function getSliderSettings(){return{dots:!0,infinite:!0,autoplay:!1,speed:500,slidesToShow:1,centerMode:!0,variableWidth:!0,slidesToShow:1,slidesToScroll:1,arrows:!0}}function fixInfowindowScroll(){setTimeout(function(){$(".map-master-div").parent().parent().attr("style","overflow: hidden; cursor: default; clear: both; position: relative; padding: 0px; background-color: rgb(255, 255, 255); border-color: rgb(204, 204, 204); border-style: solid; border-radius: 10px; border-width: 1px; width: 300px; height: 227px;"),$(".map-master-div").css("width","100%")},100),setTimeout(function(){$(".map-master-div").parent().parent().attr("style","overflow: hidden; cursor: default; clear: both; position: relative; padding: 0px; background-color: rgb(255, 255, 255); border-color: rgb(204, 204, 204); border-style: solid; border-radius: 10px; border-width: 1px; width: 300px; height: 227px;"),$(".map-master-div").css("width","100%")},200),setTimeout(function(){$(".map-master-div").parent().parent().attr("style","overflow: hidden; cursor: default; clear: both; position: relative; padding: 0px; background-color: rgb(255, 255, 255); border-color: rgb(204, 204, 204); border-style: solid; border-radius: 10px; border-width: 1px; width: 300px; height: 227px;"),$(".map-master-div").css("width","100%")},400)}function fixImageSlider(){$(".listing-right").scrollTop(0),setTimeout(function(){$(".variable-width").slick("unslick"),$(".variable-width").slick(getSliderSettings())},500),setTimeout(function(){$(".variable-width").slick("unslick"),$(".variable-width").slick(getSliderSettings())},1e3),setTimeout(function(){$(".variable-width").slick("unslick"),$(".variable-width").slick(getSliderSettings())},1500),setTimeout(function(){$(".variable-width").slick("unslick"),$(".variable-width").slick(getSliderSettings())},2e3),setTimeout(function(){$(".variable-width").slick("unslick"),$(".variable-width").slick(getSliderSettings())},3e3),setTimeout(function(){$(".variable-width").slick("unslick"),$(".variable-width").slick(getSliderSettings())},4e3)}function clearMarkers(){map_div.gmap3({clear:{class:"markers"}}),infoBubble.close(),$("#box").empty()}var viewPortForMobile,map_div=$("#map"),last_opened_info_window_id=-1,firstTimeNotAlreadyViewed=!0,infoBubble=new InfoBubble({maxWidth:300,maxHeight:227,padding:0,disableAutoPan:!0});$(function(){if($("#user_location").geocomplete().bind("geocode:result",function(e,a){ifDeviceIsMobile()&&generateMarkers(viewPortForMobile=a.geometry.viewport),map_div.gmap3("get").setCenter(a.geometry.location)}),$(document).on("mouseenter",".showonmap9",function(e){openInfoWindowByID($(this).attr("marker_id"))}),$(document).on("click",".showonmap9",function(e){var a=$(this).attr("marker_id");window.location.hash="#"+a,openInfoWindowByID(a),showAddDetail(a)}),$(".close-detail").click(function(){window.location.hash="",closeAddDetail()}),$("#offer_submit_button").click(function(){$.ajax({headers:{"X-CSRF-TOKEN":$("meta[name=_token]").attr("content")},method:"POST",url:$("#offer_send_form").attr("action"),dataType:"json",data:$("#offer_send_form").serialize(),success:function(e){alert("Your offer has been Sent !"),$("#offer_send_form")[0].reset(),$('[data-toggle="dropdown"]').parent().removeClass("open")},error:function(e,a,t){e.responseJSON.error[0].length>10?alert(e.responseJSON.error[0]):alert("Network error"),$("#offer_send_form")[0].reset()}})}),$("#category_filter input[type=checkbox]").change(function(){var e={};$("#category_filter input[type=checkbox]:checked").each(function(a,t){e[$(t).attr("name")]=!0})}),map_div.gmap3({map:{options:{navigationControl:!1,scrollwheel:!0,streetViewControl:!1,mapTypeControl:!1,zoom:12,center:new google.maps.LatLng(latitude,longitude),mapTypeId:google.maps.MapTypeId.TERRAIN}}}),$("#map_lon_min").val().length>0){var e=new google.maps.LatLngBounds(new google.maps.LatLng($("#map_lat_min").val(),$("#map_lon_max").val()),new google.maps.LatLng($("#map_lat_max").val(),$("#map_lon_min").val()));map_div.gmap3("get").fitBounds(e)}google.maps.event.addListener(map_div.gmap3("get"),"click",function(e){try{infoBubble.close(),last_opened_info_window_id=-1,closeAddDetail()}catch(e){}}),google.maps.event.addListenerOnce(map_div.gmap3("get"),"tilesloaded",function(){map_div.gmap3("get").getZoom()>12&&map_div.gmap3("get").setZoom(12)}),google.maps.event.addListener(map_div.gmap3("get"),"idle",function(e){if(firstTimeNotAlreadyViewed){firstTimeNotAlreadyViewed=!1;var a=location.hash.substr(1);a.length>0&&isNaN(a)&&(isNaN(location.hash.substr(13))?isNaN(location.hash.substr(17))||($("input:checkbox").prop("checked",!1),$("input:checkbox[sub_category_id='"+location.hash.substr(17)+"']").prop("checked",!0)):($("input:checkbox").prop("checked",!1),$("input:checkbox[category_id='"+location.hash.substr(13)+"']").prop("checked",!0)))}if(ifDeviceIsMobile()){if(void 0==viewPortForMobile){generateMarkers(viewPortForMobile=new google.maps.LatLngBounds(new google.maps.LatLng(latitude-25/69.132,longitude-25/52.958),new google.maps.LatLng(latitude+25/69.132,longitude+25/52.958)))}}else generateMarkers(map_div.gmap3("get").getBounds())}),$("#show_paginator").bootpag({total:$("meta[name=total_no_of_pages]").attr("content"),page:$("meta[name=current_page_no]").attr("content"),maxVisible:$("meta[name=max_visible]").attr("content"),leaps:!0,wrapClass:"pagination",activeClass:"active",disabledClass:"disabled",nextClass:"next",prevClass:"prev",lastClass:"last",firstClass:"first"}).on("page",function(e,a){$("meta[name=current_page_no]").attr("content",a),$("meta[name=is_paginator_clicked]").attr("content",!0),ifDeviceIsMobile()?generateMarkers(viewPortForMobile):generateMarkers(map_div.gmap3("get").getBounds()),$("meta[name=is_paginator_clicked]").attr("content",!1)}),$("#category_filter :checkbox").on("change",function(){"not_available"===$(this).attr("sub_category_id")?$("input:checkbox[category_id='"+$(this).attr("category_id")+"']").prop("checked",$(this).prop("checked")):$("input:checkbox[category_id='"+$(this).attr("category_id")+"'][sub_category_id!='not_available']:checked").length==$("input:checkbox[category_id='"+$(this).attr("category_id")+"'][sub_category_id!='not_available']").length?$("input:checkbox[category_id='"+$(this).attr("category_id")+"'][sub_category_id='not_available']").prop("checked",!0):$("input:checkbox[category_id='"+$(this).attr("category_id")+"'][sub_category_id='not_available']").prop("checked",!1),ifDeviceIsMobile()?generateMarkers(viewPortForMobile):generateMarkers(map_div.gmap3("get").getBounds())}),$(".range-slider").jRange({from:0,to:1e3,step:1,scale:[0,100,200,300,400,500,600,700,800,900,"1000+"],format:"%s",width:100,showLabels:!1,isRange:!0,ondragend:function(e){ifDeviceIsMobile()?generateMarkers(viewPortForMobile):generateMarkers(map_div.gmap3("get").getBounds())}}),$("#sort_ordering").change(function(){ifDeviceIsMobile()?generateMarkers(viewPortForMobile):generateMarkers(map_div.gmap3("get").getBounds())}),$("form#write_review").submit(function(e){e.preventDefault(),$.ajax({headers:{"X-CSRF-TOKEN":$("meta[name=_token]").attr("content")},type:"POST",url:$(this).attr("action"),data:$("#write_review").serialize(),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){for(var a="",t=0;t<e.rating;t++)a+='<i class="fa fa-star fa-xs green-text"></i>';for(t=e.rating;t<5;t++)a+='<i class="fa fa-star-o fa-xs"></i>';var i='<div class="col-lg-4 rone">'+e.user_name+"<br>"+a+"<br/><span>"+e.time+'</span></div><div class="col-lg-8 rtwo"><span>'+e.review+'</span></div><div class="clearfix margin-twenty"></div>';$(".reviews").prepend(i),$(".review").fadeOut()},error:function(e){0===$("#lgn-pup").length?alert("You are not eligable to give this review"):$("#lgn-pup").modal("show")},complete:function(){$("#wait").css("display","none")}})}),$("form#send_message_to_owner").submit(function(e){e.preventDefault(),$.ajax({headers:{"X-CSRF-TOKEN":$("meta[name=_token]").attr("content")},type:"POST",url:$(this).attr("action"),data:$("#send_message_to_owner").serialize(),dataType:"json",success:function(e){alert("Your message has been Sent !"),$("#send_message_to_owner")[0].reset(),$(".sb-bottom").removeClass("open")},error:function(e,a,t){e.responseJSON.length>10?alert(e.responseJSON):alert("Network error"),$("#send_message_to_owner")[0].reset()}})});var a=location.hash.substr(1);a.length>0&&!isNaN(a)&&setTimeout(function(){openInfoWindowByID(a),showAddDetail(a)},1500),$(".nav-sub-category, .nav-category").click(function(e){e.preventDefault(),$("#category_filter").find(":checkbox").each(function(){$(this).prop("checked",!1)}),clearMarkers(),$("#record_showing_start").html("0"),$("#record_showing_end").html("0"),"nav-sub-category"==$(this).attr("class")?$("#category_filter").find("[sub_category_id='"+$(this).attr("sub-category-id")+"']").trigger("click"):($("#category_filter").find("[category_id='"+$(this).attr("category-id")+"']").prop("checked",!0),$("#category_filter").find("[category_id='"+$(this).attr("category-id")+"']").trigger("click"))})}),$(function(){var e=$(".loaded-image").size(),a=0;$("body").loadie(),$(".loaded-image").bind("load",function(){$(this).show(),a++,$("body").loadie(a/e)}),function(e){e.fn.rating=function(){function a(a,t){var i=e(a).find("[data-value="+t+"]");i.removeClass("fa-star-o").addClass("fa-star"),i.prevAll("[data-value]").removeClass("fa-star-o").addClass("fa-star"),i.nextAll("[data-value]").removeClass("fa-star").addClass("fa-star-o")}function t(a){var t=e(a);t.find("[data-value]").removeClass("fa-star").addClass("fa-star-o"),t.find(".rating-clear").hide(),t.find("input").val("").trigger("change")}var i;for(i=this.length-1;i>=0;i--){var o,n,r=e(this[i]),s=r.data("max")||5,l=r.data("min")||0,d=r.data("clearable")||null,c="";for(n=l;n<=s;n++)c+=['<span class="fa fa-star-o" data-value="',n,'"></span>'].join("");d&&(c+=[' <a class="rating-clear" style="display:none;" href="javascript:void">','<span class="glyphicon glyphicon-remove"></span> ',d,"</a>"].join("")),o=['<div class="rating-input">',c,'<input type="hidden" name="',r.attr("name"),'" value="',r.val(),'" id="',r.attr("id"),'" />',"</div>"].join(""),r.replaceWith(o)}e(".rating-input").on("mouseenter","[data-value]",function(){var t=e(this);a(t.closest(".rating-input"),t.data("value"))}).on("mouseleave","[data-value]",function(){var i=e(this),o=i.siblings("input").val();o?a(i.closest(".rating-input"),o):t(i.closest(".rating-input"))}).on("click","[data-value]",function(a){var t=e(this),i=t.data("value");t.siblings("input").val(i).trigger("change"),t.siblings(".rating-clear").show(),a.preventDefault()}).on("click",".rating-clear",function(a){t(e(this).closest(".rating-input")),a.preventDefault()}).each(function(){var t=e(this).find("input").val();t&&(a(this,t),e(this).find(".rating-clear").show())})},e(function(){e("input.rating[type=number]").length>0&&e("input.rating[type=number]").rating()})}(jQuery)});